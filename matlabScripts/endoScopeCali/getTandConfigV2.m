function [T,Psi]=getTandConfigV2
% t = 4.1636;
% f = 1.2026e+03;
M=[    38.6475 21.3799 82.1298    -52.9573 17.5321 93.0285    40.6502 -28.5799 87.0339
 38.7055 21.3398 86.9301    -52.728 17.4485 97.5896    40.8658 -28.7 92.1095
  38.7726 21.2973 91.3315    -52.4993 17.3901 101.894    40.9097 -28.6738 96.4092
  38.9386 21.332 96.4405    -52.8365 17.5421 107.863    41.194 -28.8062 101.736
  39.1692 21.3796 101.62    -52.1071 17.3298 111.517    41.2496 -28.7252 106.375
  38.1949 21.1726 81.411    -52.7761 17.4713 92.9555    40.3304 -28.3534 86.6084
  37.6966 29.2352 85.9654    -52.9487 24.0836 96.7448    40.1928 -20.6559 87.476
  38.4584 20.8444 84.3772    -52.1139 19.9325 95.2834    39.8636 -26.8927 97.6013
  38.8298 25.6318 81.2104    -51.8293 24.6214 92.8567    40.3051 -21.9958 94.5089
  37.1425 27.94 90.9625    -52.9301 21.8669 100.698    39.769 -21.8007 89.1347
   42.7178 21.4756 94.5936    -47.9089 17.2789 91.9068    43.1665 -27.6768 98.3797
   46.4203 21.8115 87.422    -44.51 17.7348 91.7451    47.6184 -27.6481 92.1649
   42.2829 23.2505 78.2036    -45.627 19.8505 102.61    44.8905 -26.0409 82.7426
   34.0378 23.7433 81.7521    -53.7541 20.7009 107.338    37.4091 -25.041 87.4563
   23.8839 23.6602 84.9464    -65.7859 20.3894 103.476    26.8077 -25.1083 90.7269
   45.2582 24.4261 79.1786    -41.0888 21.1234 110.746    48.6097 -25.0894 83.8735
   54.0986 21.6241 90.2731    -36.7777 17.5756 95.7497    56.1479 -28.2192 96.4517
   30.3937 21.9378 96.7493    -60.3414 17.9196 88.5116    31.286 -27.4342 102.786
   37.7444 18.5113 85.8816    -52.3989 17.6934 96.1206    38.6543 -28.7422 98.1547
 38.0254 28.7642 83.3655    -52.8352 29.1676 95.2085    39.0741 -17.3675 99.9793
   38.3559 22.3222 80.6445    -51.7638 18.6447 91.5751    40.5391 -26.9134 86.4227
  38.0271 22.2082 70.8857    -52.3802 18.6331 82.358    40.1337 -26.9371 76.6069
   38.5147 22.3617 85.0139    -51.8252 18.671 95.8998    40.4364 -26.8502 90.162];

Cf=[20	0	0	0	0
15	0	0	0	0
10	0	0	0	0
5	0	0	0	0
0	0	0	0	0
20	0	0	0	0
20	30	0	35	180
20	40	180	50	0
20	30	180	40	0
20	45	0	55	180
20	45	90	55	-90
20	30	90	35	-90
20	45	-90	55	90
20	30	-90	40	90
20	15	-90	20	90
20	45	-90	55	90
20	45	-90	50	90
20	45	-90	60	90
20	45	90	50	-90
20	45	90	60	-90
20	45	180	55	0
20	45	180	60	0
20	0	0	0	0
30	0	0	0	0
15	0	0	0	0
    ];
Cf(15,:)=[];Cf(13,:)=[];
Tst2cb=zeros(4,4,size(M,1)); %from stereoCamera to chessBoard
Tcb2st=zeros(4,4,size(M,1)); %from chessBoard to stereoCamera
Ttc2st=zeros(4,4,size(M,1)); %from chessBoard to stereoCamera
Ttc2st2=zeros(4,4,size(M,1)); %from chessBoard to stereoCamera
% figure;hold on;xlabel('X');ylabel('Y');zlabel('Z');axis equal;view([45 20]);axis([ -50 50 -50 50 00 150]);

 for i = 1 :size(M,1)
    A=M(i,1:3);
    B=M(i,4:6);
    C=M(i,7:9);
    ry = (B-A)/norm(B-A);
    rx = (C-A)/norm(C-A);
    rz = cross(rx,ry)/norm(cross(rx,ry));
    
    ry = cross(rz,rx)/norm(cross(rz,rx));
    R=[rx',ry',rz'];
    Tst2cb(1:3,1:3,i)=R;
    Tst2cb(1:3,4,i)=A';
    Tst2cb(4,4,i)=1;
    Tcb2st(:,:,i)=inv(Tst2cb(:,:,i));
%     plotCoord(Tcb2st(:,:,i));
%     plotCoord(Tst2cb(:,:,i));
 end

% get trocar coordinate
tt=zeros(size(M,1),4);
for i = 3:3
Tcb2tc=eye(4);
Atro=Tcb2st(1:3,4,1);
Btro=Tcb2st(1:3,4,2);
Ctro=Tcb2st(1:3,4,3);
tz=(Atro-Btro)/norm(Btro-Atro);
ty=(Btro-Ctro)/norm(Btro-Ctro);
tx=cross(ty,tz);tx=tx/norm(tx);
ty=cross(tz,tx);ty=ty/norm(ty);
tR=[tx,ty,tz];
Tcb2tc(1:3,1:3)=tR;
Tcb2tc(1:3,4)=Atro-tz*(18+8+30+21);
Ttc2cb=inv(Tcb2tc);
    mm=Ttc2cb*Tcb2st(:,:,1);
    tt(i,:)=rotm2axang(mm(1:3,1:3));
    tt(i,4)=tt(i,4)*180/pi;
    if(tt(i,4)>90)
        tt(i,4)=180-tt(i,4);
        tt(i,1:3)=-tt(i,1:3);
    end
end
% get Tendi in trocar
gamma3=8*pi/180;
Tend2st=[cos(gamma3) -sin(gamma3) 0 0;sin(gamma3) cos(gamma3) 0 0;0 0 1 0; 0 0 0 1];
Config=zeros(size(Cf,1),6);
for i = 1 : size(Ttc2st,3)
    Ttc2st(:,:,i)=Ttc2cb(:,:,1)*Tcb2st(:,:,i)*Tend2st; % Tcb2tc*
    Ttc2st2(:,:,i)=Ttc2cb*Tcb2st(:,:,i)*Tend2st;
    Config(i,2:6)=Cf(i,:);
    Config(i,3:6)=Config(i,3:6)*pi/180;
%     plotCoord(Ttc2st(:,:,i));
    mm=Ttc2st2(:,:,i);
    tt(i,:)=rotm2axang(mm(1:3,1:3));
    tt(i,4)=tt(i,4)*180/pi;
    if(tt(i,4)>90)
        tt(i,4)=180-tt(i,4);
        tt(i,1:3)=-tt(i,1:3);
    end
end
% sx=Ttc2st(1,4,1:28);
% sx=reshape(sx,[1 28]);
% sy=Ttc2st(2,4,1:28);
% sy=reshape(sy,[1 28]);
T=Ttc2st;
T(1:3,4,:)=Ttc2st2(1:3,4,:);
Psi=Config;
end
