function [T,Config]=getTandConfigV4
M1=[
 12.7701 19.2447 104.208    0.813415 18.4916 104.331    7.1344 12.89 103.802    13.5572 7.32757 103.986    1.59867 6.52461 102.984
  12.611 18.8101 84.65    0.59864 18.0053 84.5389    6.95542 12.3867 84.1131    13.2814 6.76376 83.7568    1.40804 6.05266 83.7462
  12.8868 19.4183 105.054    0.820771 18.4773 104.153    7.16324 12.9387 104.146    13.4787 7.28925 103.377    1.60945 6.55498 103.476
  22.3905 19.3203 106.252    10.1497 18.3473 105.03    16.462 12.7361 104.73    22.9127 7.16428 104.859    10.9892 6.50378 105.573
  29.2105 19.2296 108.53    16.963 18.3291 107.523    23.3352 12.7508 107.57    29.6923 7.12668 107.289    17.7788 6.43009 107.623
  35.2728 19.0743 112.838    23.04 18.2118 112.11    29.4588 12.6433 112.3    35.4355 6.87842 110.818    23.5077 6.18527 110.564
  2.76221 18.6785 104.331    -9.14776 17.9735 104.789    -2.79471 12.4386 104.857    3.6071 6.84238 104.446    -8.19455 6.02963 103.559
  -4.00843 18.6466 106.554    -15.9103 17.8624 106.828    -9.57041 12.4284 107.19    -3.07247 6.68605 104.843    -14.7835 5.93164 105.133
 -10.5136 18.4205 110.175    -22.4424 17.5773 110.465    -16.0488 12.0718 110.455    -9.50327 6.45507 109.112    -21.2757 5.65052 109.275
  12.1787 28.1551 105.018    0.170176 27.4892 105.755    6.55643 21.7704 105.129    12.8645 15.9781 103.832    1.00643 15.2242 103.909
   11.8501 36.071 108.498    -0.333104 34.8736 107.542    6.10737 29.2669 107.399    12.5526 23.5531 107.019    0.550303 22.8904 107.728
   11.4072 43.9026 111.757    -0.763983 42.5485 110.655    5.73191 37.2269 111.43    12.1802 31.4153 110.71    0.132473 30.6352 111.062
   13.5745 8.91252 104.835    1.58472 8.06403 103.38    7.92577 2.63298 104.23    14.1128 -2.92192 103.146    2.37845 -3.61066 103.469
   14.0542 1.99925 106.777    2.15528 1.23336 105.072    8.40452 -4.24167 105.835    14.6205 -9.6485 105.105    2.90652 -10.2368 104.086
   14.0952 -4.28621 108.907    2.42579 -5.02258 108.843    8.61169 -10.3561 108.282    14.7587 -15.7379 107.808    3.22251 -16.4653 108.01
   12.5962 19.6543 104.859    0.565954 18.8169 104.566    6.90412 13.1654 103.971    13.2603 7.56143 103.8    1.35643 6.76002 103.043
 12.8604 19.4861 104.153    0.919336 18.7838 104.69    7.25915 13.1645 104.276    13.6138 7.52693 103.814    1.70774 6.7262 102.898];
M2=[
   -18.004 -18.5263 87.3628    -6.10751 -17.8225 88.5838    -12.4256 -12.1522 87.5421    -18.7687 -6.57754 86.9433    -6.80752 -5.76626 86.9808
  -17.9383 -18.7039 92.2628    -6.02329 -17.9398 93.2943    -12.3868 -12.3399 92.5041    -18.697 -6.73571 91.7149    -6.80414 -5.9574 92.227
    -17.9561 -18.8192 97.0113    -6.03706 -18.002 97.608    -12.557 -12.5662 98.1693    -18.7856 -6.90001 96.7937    -6.8984 -6.12345 97.589
   -18.1462 -19.0094 102.46    -6.14521 -18.1667 102.891    -12.5652 -12.6621 102.77    -18.6759 -6.98143 100.982    -6.87916 -6.18479 101.59
    -18.2814 -19.2688 108.024    -6.17263 -18.3117 107.857    -12.5865 -12.8091 107.717    -19.0806 -7.22834 107.559    -6.96176 -6.33767 106.962
    -18.0731 -18.6349 87.8554    -6.07765 -17.8623 88.6899    -12.3986 -12.1633 87.6261    -18.7122 -6.58046 86.8988    -6.75414 -5.74087 86.8283
    -23.24 -17.4995 93.99    -11.2632 -16.7311 93.7794    -17.5902 -11.0803 93.4047    -23.8361 -5.4873 92.95    -11.9496 -4.70733 92.4283
    -18.8105 -20.2979 89.4034    -7.20286 -19.5681 92.5218    -13.5282 -14.0053 91.247    -19.5964 -8.30126 88.928    -8.08094 -7.57287 91.8383
    -23.376 -20.3361 86.7005    -11.6448 -19.4328 89.0461    -17.849 -13.8558 87.4555    -24.1115 -8.292 86.1498    -12.5675 -7.56996 89.1173
    -17.7053 -16.5667 100.452    -5.62568 -15.6041 97.9209    -12.0559 -10.1387 99.0698    -18.4199 -4.53721 99.4044    -6.45461 -3.71259 96.9277
    -18.6374 -19.5801 97.0011    -6.59645 -18.6357 97.4345    -12.8786 -13.1193 95.5222    -19.1827 -7.65969 93.8731    -7.30906 -6.8061 94.5069
  -17.8073 -23.2153 91.5666    -5.85593 -22.3609 92.226    -12.2207 -16.875 91.3435    -18.652 -11.3266 90.5847    -6.63391 -10.4637 90.7918
    -17.4693 -17.8455 93.5081    -5.36982 -17.0224 93.3523    -11.7365 -11.5228 94.0286    -18.001 -5.98857 94.1593    -6.11589 -5.27664 94.4418
    -17.1352 -24.1582 88.6208    -5.08816 -23.432 88.9212    -11.3993 -17.7987 89.1462    -17.919 -12.3453 90.51    -5.84024 -11.6159 90.2664
    -17.515 -19.9887 87.1198    -5.47631 -19.2097 87.2914    -11.886 -13.6833 87.7364    -18.1179 -8.01542 87.2533    -6.25576 -7.3869 88.033
    -17.5554 -18.0136 93.6292    -5.36507 -17.0834 92.9422    -11.8677 -11.7235 94.4915    -18.1273 -6.15311 94.5528    -6.14337 -5.41022 94.3151
   -18.4141 -7.14069 93.6636    -6.48536 -6.38571 93.9459    -12.7786 -0.897155 93.9867    -18.8285 4.58807 93.0138    -7.21258 5.31617 94.004
    -16.3814 -29.1212 91.1023    -4.34297 -28.4143 91.4677    -10.7341 -22.9599 92.6029    -17.0661 -17.4515 93.5013    -5.14179 -16.8015 93.9143
    -17.6603 -30.9016 95.2913    -5.70738 -30.1583 96.5677    -12.0427 -24.4328 94.9818    -18.4247 -18.8407 93.8859    -6.39682 -17.8804 93.9904
   -19.3522 -7.83411 96.1957    -7.44127 -6.87746 96.7256    -13.7158 -1.61411 94.6984    -19.7764 3.60756 91.7427    -8.00714 4.51245 91.9851
   -17.3923 -19.3369 90.1892    -5.74455 -18.5175 92.6788    -11.9612 -12.9819 91.2747    -18.3099 -7.43662 90.234    -6.53567 -6.63367 91.8894
    -28.439 -20.5817 88.1042    -16.8346 -19.7229 91.2157    -22.8258 -14.039 88.9825    -28.6401 -8.38174 86.3766    -17.6266 -7.73977 90.8941
    -18.3529 -17.2752 76.7734    -6.40328 -16.4901 77.4601    -12.7888 -10.9556 77.1579    -18.8969 -5.29775 75.7476    -7.12847 -4.59221 76.644
    -18.5588 -17.6003 91.5212    -6.63415 -16.8228 92.1843    -12.9757 -11.3064 91.7928    -19.2564 -5.68268 90.9211    -7.38197 -4.93044 91.6086    
];
M=M1;
Cf=[
0	0	0	0	0	0
0	20	0	0	0	0
0	0	0	0	0	0
0	0	15	0	15	180
0	0	30	0	30	180
0	0	45	0	45	180
0	0	15	180	15	0
0	0	30	180	30	0
0	0	45	180	45	0
0	0	15	90	15	-90
0	0	30	90	30	-90
0	0	45	90	45	-90
0	0	15	-90	15	90
0	0	30	-90	30	90
0	0	45	-90	45	90
0	0	0	0	0	0
0	0	0	0	0	0
    
];

Tst2cb=zeros(4,4,size(M,1));
Tcb2st=zeros(4,4,size(M,1));
% figure;hold on;xlabel('X');ylabel('Y');zlabel('Z');axis equal;view([45 20]);axis([ -50 50 -50 50 50 150]);

for i = 1:size(M,1)
    A=M(i,1:3);
    B=M(i,4:6);
    C=M(i,10:12);
    O=M(i,7:9);
    rx=(B-A)/norm(A-B);
    ry=(C-A)/norm(A-C);
    rz=cross(rx,ry)/norm(cross(rx,ry));
    ry=cross(rz,rx);
    R=[rx' ry' rz'];
    P=O';
    Tst2cb(1:3,1:3,i)=R;Tst2cb(1:3,4,i)=P;
    Tst2cb(4,4,i)=1;
    Tcb2st(:,:,i)=inv(Tst2cb(:,:,i));
%     plotCoord(Tst2cb(:,:,i));
end


%% calc trocar coordinate
L1=18;Lr=8;L2=30;Lg=19;
ang=atan(-15.39);
ayx=cos(ang);ayy=sin(ang);ayz=0;
ay=-[ayx ayy ayz]';
nz=(Tst2cb(1:3,4,5)-Tst2cb(1:3,4,1))/norm(Tst2cb(1:3,4,1)-Tst2cb(1:3,4,5));
% nx=-(Tst2cb(1:3,4,7)-Tst2cb(1:3,4,6))/norm(Tst2cb(1:3,4,7)-Tst2cb(1:3,4,6));
nx=cross(ay,nz);
% ny=cross(nz,nx)/norm(cross(nz,nx));
% nx=cross(ny,nz)/norm(cross(ny,nz));
R=[nx,ay,nz];
Tst2end=eye(4);Tst2end(1:3,1:3)=R;Tst2end(1:3,4)=[0 0 0];
Tend2st=inv(Tst2end);
Tend2cb=zeros(4,4,size(M,1));Tcb2end=zeros(4,4,size(M,1));Tst12sti=zeros(4,4,size(M,1));
figure;hold on;xlabel('X');ylabel('Y');zlabel('Z');axis equal;view([45 20]);axis([ -50 50 -50 50 -150 150]);

for i =1:size(M,1)
    Tend2cb(:,:,i)=Tst2cb(:,:,i);%
    Tcb2end(:,:,i)=inv(Tend2cb(:,:,i));
    Tst12sti(:,:,i)=inv(Tend2cb(:,:,i))*Tend2cb(:,:,1);
    plotCoord(Tend2cb(:,:,i));
    plotCoord(Tcb2end(:,:,i));
end
T=Tst12sti;
T(3,4,:)=T(3,4,:)+L1+Lr+L2+Lg;
Config=Cf*pi/180;
Config(:,2)=Cf(:,2);
end